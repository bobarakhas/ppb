(window.webpackJsonp=window.webpackJsonp||[]).push([[49],{1089:function(e,t,r){"use strict";var n=r(41),a=r(102),s=r(129),o=r(903),i=r(3),d=r.n(i),u=r(0),l=r.n(u),c=r(16),p=r(9),_=r(1100),f=r.n(_),y=r(82);var m=r(940),A=r(34),D=r(49),S=r(35),v=r(27),E=r(5),g=r(904),R=Object(p.a)("widgets/addressDropdown"),h=c.h.div({margin:Object(g.a)()?"1rem 0":"1rem 2rem",[v.f]:{margin:"1rem 0"}});class b extends l.a.Component{constructor(){super(...arguments),d()(this,"renderDropdownOptions",()=>this.props.addresses.map(e=>{var t=this.convertAddressToSingleLine(e);return t?{value:e.id,primaryText:t}:void 0}).filter(e=>void 0!==e)),d()(this,"convertAddressToSingleLine",e=>{var t=R("label.ellipsis"),r=function(e){var t=Object(y.a)(),r=f.a.createHandler(t);try{var n=r.formatAddress(e,{style:r.ADDRESS_FORMAT_DISPLAY_SINGLE});if("string"==typeof n)return n;throw n}catch(e){return window.onerror("griffin::formatAddressToSingleLine","",0,0,e),""}}({address_line_1:e.addressLine1&&e.addressLine1.value||e.address_line_1,address_line_2:e.addressLine2&&e.addressLine2.value||e.address_line_2,admin_area_2:e.city&&e.city.value||e.admin_area_2,admin_area_1:e.state&&e.state.value||e.admin_area_1,postal_code:e.zipcode&&e.zipcode.value||e.postal_code,country_code:e.countryCode||e.country_code});return r.length>75?r.substring(0,75)+t:r}),d()(this,"handleChange",e=>{if(e.target.value===E.p.ADD_ADDRESS)return this.props.handleAddAddress();this.props.handleSelectAddress(e.target.value)}),d()(this,"handleClick",()=>{this.props.handleAddAddress(),Object(D.a)(S.b.p2p_review_shipping_address_pressed())})}componentWillReceiveProps(e){e.shakeBillingLabel&&!this.props.shakeBillingLabel&&setTimeout(()=>{this.props.dispatch(m.f(e.shakeBillingLabel))},2e3)}render(){var{yourAddressContentKey:e,selectElementId:t,addresses:r,selectedAddress:i,hasNoAddressNeededOption:d,addNewAddressContentKey:u,showENSubTextRTR:c,shakeBillingLabel:p}=this.props;return l.a.createElement(h,null,r.length>0&&l.a.createElement(o.a,{id:t,label:l.a.createElement(l.a.Fragment,null,R(e),c&&"(".concat(A.a[e],")")),options:[...d?[{value:E.p.NO_ADDRESS_NEEDED,primaryText:R("label.noAddressNeeded")}]:[],...this.renderDropdownOptions(),{value:E.p.ADD_ADDRESS,primaryText:R(u)}],"data-nemo":"add-shipping-address",value:i.id,onChange:this.handleChange,onClick:()=>Object(D.a)(S.b.p2p_review_shipping_address_pressed())}),0===r.length&&l.a.createElement(l.a.Fragment,null,l.a.createElement(s.a,{tertiary:!0,type:"button",style:{padding:0},"data-nemo":"add-fi-btn",onClick:this.handleClick,className:p&&"addNewAddress"},R(u)),c&&l.a.createElement(n.e,{style:{color:a.fb}},A.a[u])))}}t.a=b},1100:function(e,t,r){"use strict";e.exports=r(1101)},1101:function(e,t,r){"use strict";var n=r(1102),a=r(176),s=a.assertMetadata,o=a.assertType,i=r(150),d=i.definePrivateProperty,u=i.formatMessage,l=/Unsupported value for address.country_code/;function c(){}function p(e,t){return e.countryAliasMapping[t]||t||e.country}function _(e){if(l.test(e.message))throw new Error(u("You have not loaded metadata for `{{country}}` country",{country:e.attributes.countryCode}));throw e}n.setConstants(c),Object.defineProperty(c.prototype,"formatAddress",{value:function(e,t){var r=this.metadata;try{return n.formatAddress(e,t,r,{getCountry:p.bind(null,r),handlerDefaultScript:r.script})}catch(e){_(e)}},enumerable:!0}),Object.defineProperty(c.prototype,"validateAddress",{value:function(e,t){var r=this.metadata;try{return n.validateAddress(e,t,r,{handlerDefaultScript:r.script,getCountry:p.bind(null,r)})}catch(e){_(e)}},enumerable:!0}),Object.defineProperty(c.prototype,"transformAddress",{value:function(e,t){var r=this.metadata;try{return n.transformAddress(e,t,r,{getCountry:p.bind(null,r)})}catch(e){_(e)}},enumerable:!0}),e.exports={createHandler:function(e){o(e,"metadata",["plain object"]),s(e.griffin),s(e.griffin.address),e=e.griffin.address,s(e.country,["string"]),s(e.language,["string"]),s(e.script,["string"]),s(e.territory);var t=new c;return d(t,"metadata",e),t}}},1102:function(e,t,r){"use strict";var n=r(176),a=n.assertRange,s=n.assertType,o=r(150),i=o.defineProperties,d=o.getValueOrDefault,u=o.isLatin,l=o.jsonDeepMerge,c=o.objectGet,p=o.objectValues,_=o.trimObject,f=r(123),y={ADDRESS_FORMAT_INPUT:"input",ADDRESS_FORMAT_DISPLAY_SINGLE:"single_line",ADDRESS_FORMAT_DISPLAY_MULTI:"multi_line"},m={ADDRESS_COARSE:"coarse",ADDRESS_PORTABLE:"portable",ADDRESS_PORTABLE_WITH_DETAILS:"detailed"},A={coarse:[m.ADDRESS_PORTABLE],portable:[m.ADDRESS_COARSE],detailed:[m.ADDRESS_PORTABLE]},D=p(y),S=[m.ADDRESS_COARSE,m.ADDRESS_PORTABLE],v=p(m),E=["line1","line2","state","city","postal_code","country_code"],g={DISPLAY:E},R=["address_line_1","address_line_2","address_line_3"],h=R.concat(["admin_area_4","admin_area_3","admin_area_2","admin_area_1","postal_code","country_code"]),b=h.concat(["address_details.building_name","address_details.delivery_service","address_details.street_name","address_details.street_number","address_details.street_type","address_details.sub_building"]),T={DISPLAY:["full_name","business_name"].concat(h)},O={coarse:E,portable:h,detailed:b},L=[{name:"ADDRESS_REQUIRED_FIELD_MISSING",message:"A required address field is missing",detail:"address_details"}];function I(e){var t,r=e.address,n=e.handlerDefaultScript,a=e.metadata,s=e.style||y.ADDRESS_FORMAT_INPUT,o=e.type;return t=s===y.ADDRESS_FORMAT_INPUT?c(a,["territory",r.country_code,"script",n])?n:"Latn":function(e){var t=e.address,r=e.metadata,n=e.type;if(function(e,t){var r="portable"===t?T.DISPLAY:g.DISPLAY;return(r=r.filter((function(e){return"postal_code"!==e}))).every((function(t){return u(e[t])}))}(t,n))return"Latn";return c(r,["territory",t.country_code,"primary_script"])}({address:r,metadata:a,type:o}),c(a,["territory",r.country_code,"script",t,"layout_type",o+"_"+s])||{}}function P(e,t,r,n){return c(e,["territory",t,"transform_mapping",r+"_to_"+n])}function C(e){s(e,"address",["plain object"]);var t=Object.keys(e);e.address_details&&(t=t.concat(Object.keys(e.address_details).map((function(e){return"address_details."+e})))),t.forEach((function(t){var r=c(e,t.split("."));s(r,"address."+t,"address_details"!==t?["undefined","null","string"]:["plain object"])}))}function w(e,t,r){return e=(0,r.getCountry)(e),a(e,t.territory,"Unsupported value for address.country_code: {countryCode}",{countryCode:e}),e}function N(e){var t=d(e,m.ADDRESS_PORTABLE);return s(t,"options.type",["string"]),a(t,S,"Invalid value for options.type: {type}",{type:t}),t}function j(e){if(e)return e.replace(/^{(.*?)}$/,"$1")}function M(e){var t=e.address,r=e.detailedLayout,n=e.layout,a=e.metadata,s=e.properties,o=e.type,i=c(a,["territory",t.country_code,"strings"]);i=i[Object.keys(i)[0]];var d=c(i,["address_"+o,"labels"]),u=c(i,"preset_values");return i=c(i,"address_"+o),l({layout:n,properties:Object.keys(s).reduce((function(e,r){var n,a=s[r]||{},o=c(i,["preset_values",r,"list"]),l=c(i,["preset_values",r,"group_list"]);return e[r]={casing:a&&a.casing,maxLength:a&&a.max_length,required:a&&a.required,hidden:a&&a.hidden,label:d[r],value:a.preset_data||c(t,r.split("."))||"",list:u[j(o)],groupList:u[j(l)]},n=e[r],Object.keys(n).forEach((function(e){void 0===n[e]&&delete n[e]})),e}),{})},r&&{detailedLayout:r})}function k(e,t){e.forEach((function(e){e.forEach((function(e){if("separator"===e.type)return e;var r=t[e.type]||{};e.value=function(e,t){if(void 0!==t.preset_data)return t.preset_data;var r=t.prefix||"",n=t.postfix||"",a=t.casing;return r+function(e,t){if("uppercase"===t)return e.toUpperCase();if("lowercase"===t)return e.toLowerCase();return e}(e||"",a)+n||""}(e.value,r)}))}))}function F(e,t,r){return r.map((function(r){return-1===t.indexOf(r)?{type:"separator",value:r}:{type:r,value:c(e,r.split("."))}}))}function x(e){return e.filter((function(e){return e.value})).filter((function(e,t,r){return"separator"!==e.type||(!r[t+1]||"separator"!==r[t+1].type)})).filter((function(e,t,r){return"separator"!==e.type||0!==t&&t!==r.length-1})).reduce((function(e,t){return e+t.value}),"")}function U(e,t){var r=t===m.ADDRESS_PORTABLE?h.concat("address_details"):E;return _(e,r)}function B(e){var t={};return void 0!==e.postcode&&void 0===e.postal_code&&(t.postal_code=e.postcode),void 0!==e.country&&void 0===e.country_code&&(t.country_code=e.country),Object.keys(t).length&&(e=l(e,t)),e}function Y(e,t){var r=t.address_lines.map((function(t){return x(F(e,b,t))})).filter((function(e){return""!==e})).reduce((function(e,t,r){return e["address_line_"+(r+1)]=t,e}),{}),n=f({},t);delete n.address_lines;var a=G({fromAddress:e,fromAddressFields:b,patternsData:{},transformMapping:n});return l(r,a)}function G(e){var t=e.fromAddress,r=e.fromAddressFields,n=e.patternsData,a=e.transformMapping,s={},o={},i=function(e,t){return t.replace(/^patterns\.(.*?)\.\$([0-9])$/,(function(t,r,a){return s[e]=new RegExp("^"+n[r]+"$"),o[e]=+a,r}))};return Object.keys(a).map((function(e){var n=a[e];return n=n.map(i.bind(null,e)),{toField:e,value:x(F(t,r,n))}})).filter((function(e){return""!==e.value})).reduce((function(e,t){var r,n=t.toField,a=t.value;return s[n]&&(r=a.match(s[n]),a=r[o[n]]),a&&(e[n]=a),e}),{})}function V(e,t,r){return t.reduce((function(t,n){return t.concat(function(e,t,r){if(!r[t])return[];var n,a=[],s=c(e,t.split("."));return r[t].required&&!s&&a.push({name:"ADDRESS_REQUIRED_FIELD_MISSING",message:"A required address field is missing",detail:t}),"postal_code"===t&&r[t].validation_regex&&(n=new RegExp("^"+r[t].validation_regex+"$"),s&&!n.test(s)&&a.push({name:"ADDRESS_PATTERN_VALIDATION_ERROR",message:"The field provided does not match the validation pattern",detail:{field:t}})),a}(e,n,r))}),[])}e.exports={formatAddress:function(e,t,r,n){C(e),t=d(t,{}),s(t,"options",["plain object"]);var o=d(t.style,y.ADDRESS_FORMAT_DISPLAY_MULTI);s(o,"options.style",["string"]),a(o,D,"Invalid value for options.style: {style}",{style:o});var i=N(t.type),u=d(t.showCountryName,!1);s(u,"options.showCountryName",["boolean"]),s(t.name,"options.name",["string","undefined"]),s(t.organization,"options.organization",["string","undefined"]),i===m.ADDRESS_COARSE&&(e=B(e)),e=U(e,i);try{e.country_code=w(e.country_code,r,n)}catch(t){return{errors:[{name:"ADDRESS_INVALID_COUNTRY_ERROR",message:"Unsupported country/region: "+e.country_code+" or was not loaded on the client metadata",detail:{field:"country_code"}}]}}var l=I({address:e,handlerDefaultScript:n.handlerDefaultScript,metadata:r,style:o,type:i}),c=l.properties,p=l.layout,_=l.detailedLayout;if(o===y.ADDRESS_FORMAT_INPUT)return M({address:e,detailedLayout:_,layout:p,metadata:r,properties:c,type:i});i===m.ADDRESS_PORTABLE&&e.address_details&&(e=Y(e,P(r,e.country_code,"detailed","portable"))),e.full_name=t.name,e.business_name=t.organization;var f=function(e,t,r){var n=r===m.ADDRESS_COARSE?g.DISPLAY:T.DISPLAY;return t.map(F.bind(null,e,n))}(e,_||p,i);u||(f=f.map((function(e){return e.filter((function(e){return"country_code"!==e.type}))}))),k(f,c);var A=function(e){return e.map((function(e){return x(e)})).filter((function(e){return""!==e}))}(f);return o===y.ADDRESS_FORMAT_DISPLAY_SINGLE?A.join(""):A},setConstants:function(e){i(e,y),i(e,m)},transformAddress:function(e,t,r,n){C(e),t=d(t,{}),s(t,"options",["plain object"]);var o=t.fromType;s(o,"options.fromType",["string"]),a(o,v,"Invalid value for options.fromType: {type}",{type:o});var i=O[o],u=t.toType;s(u,"options.toType",["string"]),a(u,v,"Invalid value for options.toType: {type}",{type:u}),o===m.ADDRESS_COARSE&&(e=B(e));try{var l=w(e.country_code,r,n)}catch(t){return{errors:[{name:"ADDRESS_INVALID_COUNTRY_ERROR",message:"Unsupported country/region: "+e.country_code+" or was not loaded on the client metadata",detail:{field:"country_code"}}]}}if(o===u)return e;if(a(u,A[o],"Address transformation is not allowed options.fromType: {fromType} to options.toType: {toType}",{fromType:o,toType:u}),o===m.ADDRESS_PORTABLE_WITH_DETAILS&&u===m.ADDRESS_PORTABLE)return Y(e,P(r,l,"detailed","portable"));var p=P(r,l,o,u),_=!e.address_details||!Object.keys(e.address_details).length;return o!==m.ADDRESS_PORTABLE||_||(e=Y(e,P(r,l,"detailed","portable"))),G({fromAddress:e,fromAddressFields:i,patternsData:c(r,["territory",l,"transform_mapping","transform_properties","patterns"]),transformMapping:p})},validateAddress:function(e,t,r,n){C(e),t=d(t,{}),s(t,"options",["plain object"]);var o=N(t.type),i=o===m.ADDRESS_PORTABLE?b:O[o],u=t.field;s(u,"options.field",["undefined","string"]),u&&(a(u,i,"Invalid value for options.field: {field}",{field:u}),i=[u]),o===m.ADDRESS_COARSE&&(e=B(e)),e=U(e,o);try{e.country_code=w(e.country_code,r,n)}catch(t){return{errors:[{name:"ADDRESS_INVALID_COUNTRY_ERROR",message:"Unsupported country/region: "+e.country_code+" or was not loaded on the client metadata",detail:{field:"country_code"}}]}}var l=I({address:e,handlerDefaultScript:n.handlerDefaultScript,metadata:r,type:o}),c=l.properties,p=l.detailedLayout;if(o===m.ADDRESS_PORTABLE&&p&&!u){var _=V(e,h,c),f=V(e,p.reduce((function(e,t){return t.forEach((function(t){-1!==b.indexOf(t)&&e.push(t)})),e}),[]),c);if(_.length&&f.length)return{errors:_.concat(f.filter((function(e){return/address_details/.test(e.detail)})))};if(_.length){var y=_.filter((function(e){return"ADDRESS_REQUIRED_FIELD_MISSING"===e.name&&R.includes(e.detail)}));if(y){var A=[];if(e.address_details){var D=e.address_details;Object.keys(D).forEach((function(e){D[e]&&""!==D[e]&&A.push(D[e])}))}if(!A.length)return{errors:L.concat(y)}}}return{}}var S=V(e,i,c);return S.length?{errors:S}:{}}}},904:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var n=r(19);function a(){return n.isTreatment("Trmt_p2p_review_screen_redesign")}}}]);
//# sourceMappingURL=49.esm.js.map